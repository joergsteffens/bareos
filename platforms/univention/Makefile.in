#
# This file is used as the template to create the
# Makefile for the Univention specific installation.
# Univention is based on Debian,
# therefore it also calls the Debian Makefile
#
#  for Bareos release @VERSION@ (@DATE@) -- @DISTNAME@
#
@MCOMMON@

all:
	(cd ../debian; $(MAKE) $@;)
	$(MKDIR)           ../../conffiles/
	cp -r conffiles/. ../../conffiles/.
	(cd ../..; platforms/univention/create_ucs_template_files.sh conffiles/)
	# remove autoconf template files
	find ../../conffiles/ -name "*.in" -exec rm {} \;
	@$(MKDIR)           ../../AppCenter/
	# Univention advices not to include the ini file any longer,
	# to prevent to new settings added by Univention gets overwritten.
	# Instead the settings should be done manually on the AppCenter Management interface.
	#$(INSTALL_DATA)    AppCenter/univention-bareos.ini ../../AppCenter/
	$(INSTALL_DATA)    AppCenter/LICENSE_AGREEMENT     ../../AppCenter/
	$(INSTALL_DATA)    AppCenter/README                ../../AppCenter/
	$(INSTALL_DATA)    AppCenter/README_DE             ../../AppCenter/
	$(INSTALL_DATA)    AppCenter/bareos-webui_screenshot.png  ../../AppCenter/
	$(INSTALL_DATA)    ../../src/images/bareos-logo.svg       ../../AppCenter/
	$(INSTALL_DATA)    ../../src/images/bareos-logo-full.svg  ../../AppCenter/
	# disabled. use static release key
	#sh get_bareos_release_key.sh bareos-com-release.key

install:
	(cd ../debian; $(MAKE) $@;)

	@echo "generating Univention Config Registry (UCR) files ..."
	(cd ../..; univention-install-config-registry)

	@$(MKDIR)           $(DESTDIR)/etc/bareos/autogenerated/clients/
	@$(INSTALL_CONFIG)  job-windows.template $(DESTDIR)/etc/bareos/autogenerated/clients/windows.template
	@$(INSTALL_CONFIG)  job-generic.template $(DESTDIR)/etc/bareos/autogenerated/clients/generic.template

	@$(MKDIR)           $(DESTDIR)/etc/cron.d/
	@$(INSTALL_CONFIG)  univention-bareos.cron $(DESTDIR)/etc/cron.d/univention-bareos

	@$(MKDIR)           $(DESTDIR)/usr/lib/univention-directory-listener/system
	@$(INSTALL_PROGRAM) univention-bareos.py $(DESTDIR)/usr/lib/univention-directory-listener/system

	@$(MKDIR)           $(DESTDIR)/usr/lib/univention-install/
	@$(INSTALL_PROGRAM) 62univention-bareos.inst  $(DESTDIR)/usr/lib/univention-install/

	@$(MKDIR)           $(DESTDIR)/usr/lib/univention-uninstall/
	@$(INSTALL_PROGRAM) 63univention-bareos.uinst $(DESTDIR)/usr/lib/univention-uninstall/

	@$(MKDIR)           $(DESTDIR)/usr/share/univention-bareos/
	@$(INSTALL_PROGRAM) bareos-dir-restart           $(DESTDIR)/usr/share/univention-bareos/
	@$(INSTALL_PROGRAM) bareos-dir-restart-on-change $(DESTDIR)/usr/share/univention-bareos/
	@$(INSTALL_CONFIG)  univention-bareos.schema     $(DESTDIR)/usr/share/univention-bareos/

	./create_ucs_template_scripts.sh $(DESTDIR)/etc/univention/templates/scripts/

	@$(INSTALL_CONFIG)  bareos-com-release.key $(DESTDIR)/etc/bareos/

clean:
	(cd ../debian; $(MAKE) $@;)
	@$(RMF) 1 2 3

distclean: clean
	(cd ../debian; $(MAKE) $@;)
	@$(RMF) Makefile

devclean: clean
	(cd ../debian; $(MAKE) $@;)
	@$(RMF) Makefile

%:
	(cd ../debian; $(MAKE) $@;)
